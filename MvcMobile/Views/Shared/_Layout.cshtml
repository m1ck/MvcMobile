@{
    char[] alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".ToCharArray();    
}

<!DOCTYPE html> 
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<title>Campus Directory</title> 
	        <link href="@System.Web.Optimization.BundleTable.Bundles.ResolveBundleUrl("~/Content/css")" rel="stylesheet" type="text/css" />
           <script src="@System.Web.Optimization.BundleTable.Bundles.ResolveBundleUrl("~/Scripts/js")"></script>
 
 	
    <script src="@Url.Content("~/Scripts/dust-full-0.3.0.min.js")" type="text/javascript"></script>

<style type="text/css" >
	.ui-page {
    -webkit-backface-visibility: hidden;
}
	
	
	.ui-page * {
-webkit-transform: rotateY(0deg);
-moz-transform: rotateY(0deg);
transform: rotateY(0deg);
}
	
	</style> 
	<script type="text/javascript">
        var delay = (function(){
            var timer = 0;
            return function(callback, ms){
            clearTimeout (timer);
            timer = setTimeout(callback, ms);
          };
        })();

	    $(document).bind("mobileinit", function () {
	        $.mobile.touchOverflowEnabled = true;
	    });


	    $(document).ready(function () {
           var initVal="";
	        $("input[id^='search']").keyup(function () {  initVal = $(this).val(); delay(function(){
                  ajaxsearch(initVal); }, 500 );            
             });           
	    });


	    function ajaxsearch(initVal) {
	        $.getJSON("http://netdevone.gsu.edu/directory/api/Person?givenName="+ initVal +"&sn=", displayEmployee);
	    }


	    $('#detailsPage').live('pagebeforeshow', function (event , data) {       
	        var id = getUrlVar(event.currentTarget.dataset.url)["id"];
	        $.getJSON("http://netdevone.gsu.edu/directory/api/Person/"+id, displayEmployeeDetail);
	    });

        $( document ).delegate("#searchpage", "pageinit", function() {
             var initVal="";
             $("input[id^='search']").keyup(function () {  initVal = $(this).val(); delay(function(){
                  ajaxsearch(initVal); }, 500 );            
             }); 
       });

	    function displayEmployee(data) {	             
                 var source ="@foreach (var ltr in alpha)
                 {                    
                       @Html.Raw("{~n}{^")@ltr@Html.Raw("}" );
                       @Html.Raw(" " );
                       @Html.Raw("{:else}" );
                       @Html.Raw("<li data-role='list-divider'>" );@ltr @Html.Raw("</li>" );
                       @Html.Raw("{#"); @ltr  @Html.Raw("}" );
                       @Html.Raw("{~s} <li><a href='#detailsPage?id={eduPersonPrincipalName}'  data-campusid='{eduPersonPrincipalName}' data-transition='slide'>{cn} </a></li>{~n}" );
                       @Html.Raw("{/"); @ltr  @Html.Raw("}" );
                       @Html.Raw("{/"); @ltr  @Html.Raw("}" );                      
                       @Html.Raw("{~n}" );
                 }";

	        dust.loadSource(dust.compile(source, "array"));
	        dust.render("array", data[0], function (err, out) {
	            $("[id^='actionList']").html(out);
	        });
	        $("[id^='actionList']").listview('refresh');
	    }


           
	    function displayEmployeeDetail(data) {       
	        var employee = data.item;
	        var source = "<a href='#' data-role='button' data-rel='dialog' id='cnblock' >{cn}</a><a href='#' data-role='button' data-rel='dialog' id='cnmail' >{mail}</a>";
	        dust.loadSource(dust.compile(source, "replace"));
	        dust.render("replace", data[0], function (err, out) {
	            $("#employeeDetails").html(out);
	        });
            $('#cnblock').button();$('#cnmail').button();
	    }



	    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
	    function getUrlVars() {
	        var vars = [], hash;
	        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
	        for (var i = 0; i < hashes.length; i++) {
	            hash = hashes[i].split('=');
	            vars.push(hash[0]);
	            vars[hash[0]] = hash[1];
	        }
	        return vars;
	    }

         ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
	    function getUrlVar(url) {
	        var vars = [], hash;
	        var hashes = url.slice(url.indexOf('?') + 1).split('&');
	        for (var i = 0; i < hashes.length; i++) {
	            hash = hashes[i].split('=');
	            vars.push(hash[0]);
	            vars[hash[0]] = hash[1];
	        }
	        return vars;
	    }




//$( document ).delegate("#mainpage", "pageinit", function() {
 // alert('A page with an id of "aboutPage" was just created by jQuery Mobile!');
 // var searchdata = [@Html.Raw(ViewBag.JSON)];
	//        displayEmployee(searchdata);
//});




//jQuery("div:jqmData(role='page'):last").bind('pageinit', function(){
 //   alert("asd");
 //   var searchdata = [@Html.Raw(ViewBag.JSON)];
	//        displayEmployee(searchdata);
//});

//$( document ).delegate("#searchpage", "pagebeforecreate", function() {
  //alert('A page with an id of "aboutPage" is about to be created by jQuery Mobile!');
 //   var searchdata = [@Html.Raw(ViewBag.JSON)];
	// alert(searchdata);
//	 $("#actionList_searchpage").html("asdasdoutt");
	//        displayEmployee(searchdata);

//});


	  //  $(document).ready(function () {
	        
	  //  });


      $('#@ViewBag.pageid').live('pagehide', function () {
    //$(this).remove();
});

 


 </script>
</head> 

	
<body> 



	<div data-role="page" class="type-interior" id="@ViewBag.pageid">
	  <div data-role="content" id="innercontent">
      
       @using (Html.BeginForm("Index", "Search", FormMethod.Get, new { id = "searchform", role = "search", @class = "ui-listview-filter ui-bar-d" }))
       { 
         

           @*     <form  action="/Search"  data-ajax="true" name="searchform" id="searchform" method="get"  role="search" class="ui-listview-filter ui-bar-d">		  *@		
        	    <input type="search" name="fname" id="search" value="@ViewBag.search_terms"  data-theme="d"  autocomplete="off" class="ui-input-text ui-body-d" data-type="search" placeholder="Search People..." />
                <input type="hidden" value="all" name="criteria" id="criteria" />
           @*   </form>	  *@
          
       }
             
		  @RenderBody()
	 </div><!--/content-primary -->
 </div><!-- /page -->
	
	
	
	
	
        <div id="detailsPage" data-role="page" data-add-back-btn="true" >
	                <div data-role="header" data-theme="b">
		                <h1> Details </h1>
	                </div>

                   <div data-role="content"  id="employeeDetails">
        	
                  </div>
        </div>